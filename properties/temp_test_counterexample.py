"""Test case containing a counter-example tensor representing an image pattern.
The tensor appears to be a flattened 28x28 image with normalized pixel values.
"""

import numpy as np
import onnxruntime as ort
import matplotlib.pyplot as plt

NN_MODEL = "900.onnx"



def get_model_output(model_path):
    """Get output prediction from ONNX model for the counter-example input.
    
    Args:
        model_path (str): Path to the ONNX model file
        
    Returns:
        int: Predicted class (0-9)
    """
    # Initialize ONNX runtime session
    session = ort.InferenceSession(model_path)

    # Reshape flattened input to MNIST format (1,1,28,28)
    input_data = counter_example.reshape(1, 784)

    # Get input name and run inference
    input_name = session.get_inputs()[0].name
    outputs = session.run(None, {input_name: input_data.astype(np.float32)})

    return np.argmax(outputs[0])


def main():
    """Main function to test counter-example."""
    # Get model prediction
    output = get_model_output(NN_MODEL)
    print(f"Model prediction class (0-9): {output}")


# Convert flattened array into 28x28 image tensor
counter_example = np.array([
    4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 4.99999991e-14,
    4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 4.99999991e-14,
          4.99999991e-14, 8.62745121e-02, 7.52941191e-01, 5.25490224e-01,
          1.25490203e-01, 4.99999991e-14, 4.99999991e-14, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 4.99999991e-14,
          4.99999991e-14, 5.88235296e-02, 3.01960796e-01, 1.96078438e-02,
          4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 4.99999991e-14,
          6.66666701e-02, 9.21568632e-01, 9.80392158e-01, 6.62745118e-01,
          4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 4.99999991e-14,
          5.88235296e-02, 8.62745106e-01, 9.45098042e-01, 1.45098045e-01,
          4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 7.84313753e-02,
          7.41176486e-01, 9.92156863e-01, 5.76470613e-01, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 4.99999991e-14,
          5.45098066e-01, 9.92156863e-01, 3.92156869e-01, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 2.74509817e-01,
          9.92156863e-01, 9.92156863e-01, 8.23529437e-02, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 1.68627456e-01,
          9.96078432e-01, 6.78431392e-01, 5.09803928e-02, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 8.62745121e-02, 6.00000024e-01,
          9.92156863e-01, 3.76470596e-01, 4.99999991e-14, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 1.68627456e-01, 9.05882359e-01,
          9.96078432e-01, 3.60784322e-01, 4.99999991e-14, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 6.39215708e-01, 1.00000000e+00,
          8.00000012e-01, 4.31372561e-02, 4.99999991e-14, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 4.07843143e-01, 9.96078432e-01,
          6.19607866e-01, 4.99999991e-14, 4.99999991e-14, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 6.35294139e-01, 9.92156863e-01,
          6.98039234e-01, 1.96078438e-02, 4.99999991e-14, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 4.99999991e-14,
          3.52941193e-02, 5.13725519e-01, 9.29411769e-01, 9.92156863e-01,
          4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 6.35294139e-01, 9.92156863e-01,
          9.92156863e-01, 7.49019623e-01, 6.86274529e-01, 2.74509817e-01,
          2.74509817e-01, 2.74509817e-01, 2.74509817e-01, 5.21568656e-01,
          7.72549033e-01, 9.92156863e-01, 9.92156863e-01, 6.62745118e-01,
          4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 2.00000003e-01, 8.94117653e-01,
          9.92156863e-01, 9.92156863e-01, 9.96078432e-01, 9.92156863e-01,
          9.92156863e-01, 9.92156863e-01, 9.92156863e-01, 9.96078432e-01,
          9.92156863e-01, 9.92156863e-01, 8.58823538e-01, 1.37254909e-01,
          4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 6.66666701e-02,
          2.54901975e-01, 5.37254930e-01, 9.96078432e-01, 9.09803927e-01,
          5.37254930e-01, 5.37254930e-01, 5.37254930e-01, 1.72549024e-01,
          9.92156863e-01, 9.92156863e-01, 6.31372571e-01, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 1.33333340e-01,
          9.96078432e-01, 8.07843149e-01, 8.23529437e-02, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 6.27451003e-01,
          9.92156863e-01, 2.70588249e-01, 4.99999991e-14, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 3.33333343e-01, 9.96078432e-01,
          9.45098042e-01, 1.96078435e-01, 4.99999991e-14, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 6.19607866e-01, 9.96078432e-01,
          6.47058845e-01, 4.99999991e-14, 4.99999991e-14, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 9.05882359e-01, 9.56862748e-01,
          1.96078435e-01, 4.99999991e-14, 4.99999991e-14, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 4.99999991e-14,
          4.99999991e-14, 4.07843143e-01, 9.96078432e-01, 9.09803927e-01,
          4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 4.99999991e-14,
          4.99999991e-14, 8.15686285e-01, 9.92156863e-01, 6.15686297e-01,
          4.99999991e-14, 5.09803928e-02, 1.17647059e-01, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 4.99999991e-14,
          4.99999991e-14, 8.15686285e-01, 9.92156863e-01, 6.03921592e-01,
          3.56862754e-01, 8.00000012e-01, 6.31372571e-01, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 4.99999991e-14,
          4.99999991e-14, 8.15686285e-01, 9.92156863e-01, 9.96078432e-01,
          9.92156863e-01, 6.03921592e-01, 1.13725491e-01, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 4.99999991e-14,
          4.99999991e-14, 2.39215687e-01, 7.45098054e-01, 5.01960814e-01,
          9.01960805e-02, 2.35294122e-02, 4.99999991e-14, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 4.99999991e-14,
          4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 4.99999991e-14,
    4.99999991e-14, 4.99999991e-14, 4.99999991e-14, 4.99999991e-14
]).reshape(1,1,784)


if __name__ == '__main__':
    main()